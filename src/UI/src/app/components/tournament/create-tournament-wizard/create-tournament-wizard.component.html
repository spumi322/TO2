<div class="wizard-container">
  <p-card>
    <ng-template pTemplate="header">
      <h2>Create New Tournament</h2>
      <p>Follow the steps to set up your tournament</p>
    </ng-template>

    <ng-template pTemplate="content">
      <!-- Steps Indicator -->
      <p-steps [model]="wizardSteps" [(activeIndex)]="activeStep" [readonly]="true"></p-steps>

      <!-- Step 1: Tournament Details -->
      <div *ngIf="activeStep === 0" class="step-content">
        <h3>Basic Information</h3>

        <form [formGroup]="detailsForm">
          <p-floatLabel>
            <input pInputText id="name" formControlName="name" class="w-full" />
            <label for="name">Tournament Name</label>
          </p-floatLabel>
          <small class="hint">4-100 characters</small>
          <div *ngIf="detailsForm.get('name')?.hasError('required') && detailsForm.get('name')?.touched" class="error">
            Name is required
          </div>
          <div *ngIf="detailsForm.get('name')?.hasError('minlength') && detailsForm.get('name')?.touched" class="error">
            Minimum 4 characters
          </div>
          <div *ngIf="detailsForm.get('name')?.hasError('maxlength') && detailsForm.get('name')?.touched" class="error">
            Maximum 100 characters
          </div>

          <p-floatLabel>
            <textarea pInputTextarea id="description" formControlName="description" rows="4" class="w-full"></textarea>
            <label for="description">Description</label>
          </p-floatLabel>
          <small class="hint">Optional, up to 250 characters</small>
          <div *ngIf="detailsForm.get('description')?.hasError('maxlength') && detailsForm.get('description')?.touched" class="error">
            Maximum 250 characters
          </div>

          <!-- WIP Section -->
          <div class="wip-section">
            <h4>Date & Schedule <span class="wip-badge">WORK IN PROGRESS</span></h4>
            <p>Tournament scheduling features coming soon!</p>
          </div>

          <div class="step-actions">
            <button pButton label="Back" icon="pi pi-arrow-left" disabled></button>
            <button pButton label="Next: Choose Format" icon="pi pi-arrow-right" iconPos="right"
                    [disabled]="!detailsForm.valid" (click)="nextStep()"></button>
          </div>
        </form>
      </div>

      <!-- Step 2: Format Selection -->
      <div *ngIf="activeStep === 1" class="step-content">
        <h3>Select Tournament Format</h3>
        <p>Choose the structure that best fits your tournament</p>

        <form [formGroup]="formatForm">
          <div class="format-cards">
            <!-- BracketOnly Card -->
            <div class="format-card" [class.selected]="selectedFormat === Format.BracketOnly"
                 (click)="selectFormat(Format.BracketOnly)">
              <i class="pi pi-sitemap format-icon"></i>
              <h4>Bracket Only</h4>
              <p>Single-elimination bracket. Teams compete in knockout rounds.</p>
              <ul>
                <li><i class="pi pi-check"></i> Random seeding</li>
                <li><i class="pi pi-check"></i> Power-of-2 teams</li>
                <li><i class="pi pi-check"></i> Fast format</li>
              </ul>
              <p-radioButton name="format" [value]="Format.BracketOnly"
                             formControlName="format" label="Select Bracket Only"></p-radioButton>
            </div>

            <!-- GroupsAndBracket Card -->
            <div class="format-card" [class.selected]="selectedFormat === Format.GroupsAndBracket"
                 (click)="selectFormat(Format.GroupsAndBracket)">
              <i class="pi pi-th-large format-icon"></i>
              <h4>Groups + Bracket</h4>
              <p>Round-robin groups followed by bracket playoffs.</p>
              <ul>
                <li><i class="pi pi-check"></i> Group stage</li>
                <li><i class="pi pi-check"></i> Top teams advance</li>
                <li><i class="pi pi-check"></i> Balanced competition</li>
              </ul>
              <p-radioButton name="format" [value]="Format.GroupsAndBracket"
                             formControlName="format" label="Select Groups + Bracket"></p-radioButton>
            </div>

            <!-- GroupsOnly Card -->
            <div class="format-card" [class.selected]="selectedFormat === Format.GroupsOnly"
                 (click)="selectFormat(Format.GroupsOnly)">
              <i class="pi pi-table format-icon"></i>
              <h4>Groups Only</h4>
              <p>Round-robin groups only. Final standings determine placement.</p>
              <ul>
                <li><i class="pi pi-check"></i> No single winner</li>
                <li><i class="pi pi-check"></i> Group rankings</li>
                <li><i class="pi pi-check"></i> Multiple matches</li>
              </ul>
              <p-radioButton name="format" [value]="Format.GroupsOnly"
                             formControlName="format" label="Select Groups Only"></p-radioButton>
            </div>
          </div>

          <div class="step-actions">
            <button pButton label="Back" icon="pi pi-arrow-left" (click)="prevStep()"></button>
            <button pButton label="Next: Configure Teams" icon="pi pi-arrow-right" iconPos="right"
                    [disabled]="!formatForm.valid" (click)="nextStep()"></button>
          </div>
        </form>
      </div>

      <!-- Step 3: Team Configuration -->
      <div *ngIf="activeStep === 2" class="step-content">
        <h3>Configure Team Settings</h3>
        <p>Set up configuration for <strong>{{ getFormatDisplayName(selectedFormat) }}</strong></p>

        <form [formGroup]="configForm">
          <!-- BracketOnly Configuration -->
          <div *ngIf="selectedFormat === Format.BracketOnly">
            <p-floatLabel>
              <p-dropdown id="maxTeams" formControlName="maxTeams"
                          [options]="bracketSizes" optionLabel="label" optionValue="value"
                          class="w-full"></p-dropdown>
              <label for="maxTeams">Tournament Size</label>
            </p-floatLabel>
            <small class="hint">Select power-of-2 team count</small>
            <div *ngIf="configForm.get('maxTeams')?.hasError('required') && configForm.get('maxTeams')?.touched" class="error">
              Tournament size is required
            </div>
            <div *ngIf="configForm.get('maxTeams')?.hasError('powerOfTwo') && configForm.get('maxTeams')?.touched" class="error">
              Must be power of 2
            </div>
          </div>

          <!-- GroupsAndBracket Configuration -->
          <div *ngIf="selectedFormat === Format.GroupsAndBracket">
            <p-floatLabel>
              <input pInputText id="teamsPerGroup" type="number" formControlName="teamsPerGroup"
                     min="2" max="16" class="w-full" />
              <label for="teamsPerGroup">Teams per Group</label>
            </p-floatLabel>
            <small class="hint">2-16 teams in each group</small>
            <div *ngIf="configForm.get('teamsPerGroup')?.hasError('required') && configForm.get('teamsPerGroup')?.touched" class="error">
              Teams per group is required
            </div>
            <div *ngIf="configForm.get('teamsPerGroup')?.hasError('min') && configForm.get('teamsPerGroup')?.touched" class="error">
              Minimum 2 teams per group
            </div>
            <div *ngIf="configForm.get('teamsPerGroup')?.hasError('max') && configForm.get('teamsPerGroup')?.touched" class="error">
              Maximum 16 teams per group
            </div>

            <p-floatLabel>
              <input pInputText id="teamsPerBracket" type="number" formControlName="teamsPerBracket"
                     min="4" max="32" class="w-full" />
              <label for="teamsPerBracket">Teams Advancing to Bracket</label>
            </p-floatLabel>
            <small class="hint">4-32 teams advancing</small>
            <div *ngIf="configForm.get('teamsPerBracket')?.hasError('required') && configForm.get('teamsPerBracket')?.touched" class="error">
              Teams per bracket is required
            </div>
            <div *ngIf="configForm.get('teamsPerBracket')?.hasError('min') && configForm.get('teamsPerBracket')?.touched" class="error">
              Minimum 4 teams per bracket
            </div>
            <div *ngIf="configForm.get('teamsPerBracket')?.hasError('max') && configForm.get('teamsPerBracket')?.touched" class="error">
              Maximum 32 teams per bracket
            </div>

            <p-floatLabel>
              <input pInputText id="maxTeams" type="number" formControlName="maxTeams"
                     min="2" max="64" class="w-full" />
              <label for="maxTeams">Total Tournament Size</label>
            </p-floatLabel>
            <small class="hint">Must be divisible by teams per group</small>
            <div *ngIf="configForm.get('maxTeams')?.hasError('required') && configForm.get('maxTeams')?.touched" class="error">
              Total teams is required
            </div>
            <div *ngIf="configForm.get('maxTeams')?.hasError('divisibleBy') && configForm.get('maxTeams')?.touched" class="error">
              Must be divisible by teams per group
            </div>
          </div>

          <!-- GroupsOnly Configuration -->
          <div *ngIf="selectedFormat === Format.GroupsOnly">
            <p-floatLabel>
              <input pInputText id="teamsPerGroup" type="number" formControlName="teamsPerGroup"
                     min="2" max="16" class="w-full" />
              <label for="teamsPerGroup">Teams per Group</label>
            </p-floatLabel>
            <small class="hint">2-16 teams in each group</small>
            <div *ngIf="configForm.get('teamsPerGroup')?.hasError('required') && configForm.get('teamsPerGroup')?.touched" class="error">
              Teams per group is required
            </div>
            <div *ngIf="configForm.get('teamsPerGroup')?.hasError('min') && configForm.get('teamsPerGroup')?.touched" class="error">
              Minimum 2 teams per group
            </div>
            <div *ngIf="configForm.get('teamsPerGroup')?.hasError('max') && configForm.get('teamsPerGroup')?.touched" class="error">
              Maximum 16 teams per group
            </div>

            <p-floatLabel>
              <input pInputText id="maxTeams" type="number" formControlName="maxTeams"
                     min="2" max="32" class="w-full" />
              <label for="maxTeams">Total Tournament Size</label>
            </p-floatLabel>
            <small class="hint">Must be divisible by teams per group</small>
            <div *ngIf="configForm.get('maxTeams')?.hasError('required') && configForm.get('maxTeams')?.touched" class="error">
              Total teams is required
            </div>
            <div *ngIf="configForm.get('maxTeams')?.hasError('divisibleBy') && configForm.get('maxTeams')?.touched" class="error">
              Must be divisible by teams per group
            </div>
          </div>

          <div class="step-actions">
            <button pButton label="Back" icon="pi pi-arrow-left" (click)="prevStep()"></button>
            <button pButton label="Create Tournament" icon="pi pi-check"
                    [disabled]="!configForm.valid || isSubmitting"
                    [loading]="isSubmitting" (click)="submit()"></button>
          </div>
        </form>
      </div>
    </ng-template>
  </p-card>
</div>

<!-- Toast for notifications -->
<p-toast></p-toast>
