<div class="tournament-details-container" *ngIf="tournament$ | async as tournament">
  <!-- Tournament Header -->
  <div class="tournament-header">
    <div class="header-content">
      <div class="tournament-badge" [ngClass]="getStatusClass(tournament.status)">
        {{ getStatusLabel(tournament.status) }}
      </div>
      <h1>{{ tournament?.name }}</h1>
      <p class="format-label">{{ getFormatLabel(tournament.format) }}</p>
    </div>
    <div class="tournament-actions" *ngIf="tournament?.isRegistrationOpen">
      <button mat-raised-button color="primary" (click)="startTournament()"
              [disabled]="!tournament || (tournament?.teams?.length || 0) < 2 || isReloading">
        <mat-icon>play_arrow</mat-icon> Start Tournament
      </button>
    </div>
  </div>

  <!-- Champion Banner -->
  <div class="champion-banner" *ngIf="tournament?.status === TournamentStatus.Finished && champion">
    <mat-icon class="trophy-icon">emoji_events</mat-icon>
    <div class="champion-text">
      <h2>CHAMPION</h2>
      <h1>{{ champion.name }}</h1>
    </div>
    <mat-icon class="trophy-icon">emoji_events</mat-icon>
  </div>

  <!-- Main Content Area -->
  <div class="tournament-content">
    <mat-tab-group [(selectedIndex)]="selectedTabIndex" animationDuration="300ms" mat-stretch-tabs="false" mat-align-tabs="start">
      <!-- Overview Tab -->
      <mat-tab label="Overview">
        <div class="tab-content">
          <div class="overview-grid">
            <!-- Tournament Info -->
            <mat-card class="info-card">
              <mat-card-header>
                <mat-icon mat-card-avatar>info</mat-icon>
                <mat-card-title>Tournament Details</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <p *ngIf="tournament?.description">{{ tournament?.description }}</p>
                <p *ngIf="!tournament?.description" class="muted-text">No description provided</p>
                <div class="info-grid">
                  <div class="info-item">
                    <span class="label">Format</span>
                    <span class="value">{{ getFormatLabel(tournament.format) }}</span>
                  </div>
                  <div class="info-item">
                    <span class="label">Max Teams</span>
                    <span class="value">{{ tournament?.maxTeams }}</span>
                  </div>
                  <div class="info-item" *ngIf="tournament?.format === Format.BracketAndGroups">
                    <span class="label">Teams per Group</span>
                    <span class="value">{{ getTeamsPerGroup() || '-' }}</span>
                  </div>
                  <div class="info-item" *ngIf="tournament?.format === Format.BracketOnly || tournament?.format === Format.BracketAndGroups">
                    <span class="label">Teams per Bracket</span>
                    <span class="value">{{ getTeamsPerBracket() || '-' }}</span>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
            <!-- Team Management -->
            <mat-card class="teams-card" *ngIf="tournament?.isRegistrationOpen">
              <mat-card-header>
                <mat-icon mat-card-avatar>groups</mat-icon>
                <mat-card-title>Team Management</mat-card-title>
                <mat-card-subtitle>{{ tournament?.teams?.length || 0 }}/{{ tournament?.maxTeams }} teams registered</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <mat-progress-bar mode="determinate" [value]="((tournament?.teams?.length || 0) / (tournament?.maxTeams || 1)) * 100"></mat-progress-bar>

                <!-- Bulk Add Form -->
                <form [formGroup]="bulkAddForm" (ngSubmit)="addBulkTeams()" class="bulk-add-form">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Team Names (comma separated)</mat-label>
                    <textarea matInput formControlName="teamNames"  rows="3"></textarea>
                    <mat-hint>Enter multiple team names separated by commas</mat-hint>
                    <mat-error *ngIf="bulkAddForm.get('teamNames')?.hasError('required')">Team names are required</mat-error>
                  </mat-form-field>
                  <div class="form-actions">
                    <button mat-raised-button color="primary" type="submit" [disabled]="bulkAddForm.invalid || isAddingTeams">
                      <mat-icon>add_circle</mat-icon> Add Teams
                    </button>
                  </div>
                </form>
              </mat-card-content>
            </mat-card>
          </div>
          <!-- Registered Teams -->
          <mat-card class="registered-teams-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>people</mat-icon>
              <mat-card-title>Registered Teams</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div *ngIf="!(tournament?.teams?.length)" class="empty-state">
                <mat-icon class="empty-icon">sports_esports</mat-icon>
                <p>No teams have been registered yet</p>
                <p *ngIf="tournament?.isRegistrationOpen" class="muted-text">Add teams using the form above</p>
              </div>
              <div *ngIf="tournament?.teams?.length" class="teams-grid">
                <div *ngFor="let team of tournament?.teams" class="team-card">
                  <div class="team-avatar">{{ team?.name?.charAt(0) }}</div>
                  <div class="team-name">{{ team?.name }}</div>
                  <button *ngIf="tournament?.isRegistrationOpen" mat-icon-button color="warn" (click)="confirmRemoveTeam(team)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
      <!-- Group Stage Tab (only if format is BracketAndGroups and tournament has started) -->
      <mat-tab label="Group Stage" *ngIf="!tournament?.isRegistrationOpen && tournament?.format === Format.BracketAndGroups">
        <div class="tab-content">
          <app-standing-group
            [tournament]="tournament"
            (matchFinished)="onGroupMatchFinished($event)">
          </app-standing-group>
        </div>
      </mat-tab>

      <!-- Bracket Tab (when tournament has started and bracket exists) -->
      <mat-tab label="Bracket" *ngIf="!tournament?.isRegistrationOpen && brackets.length > 0">
        <div class="tab-content">
          <app-standing-bracket
            [tournament]="tournament"
            [standingId]="brackets[0]?.id">
          </app-standing-bracket>
        </div>
      </mat-tab>

      <!-- Results Tab (only if tournament is finished) -->
      <mat-tab label="Results" *ngIf="tournament?.status === TournamentStatus.Finished">
        <div class="tab-content">
          <div class="results-container">
            <h2>Final Standings</h2>

            <!-- Podium Display -->
            <div class="podium" *ngIf="finalStandings.length >= 3">
              <!-- 2nd Place -->
              <div class="podium-place second">
                <mat-icon class="medal-icon silver">military_tech</mat-icon>
                <div class="place-number">2nd</div>
                <div class="team-name">{{ finalStandings[1]?.teamName }}</div>
                <div class="eliminated-info">Eliminated in Round {{ finalStandings[1]?.eliminatedInRound }}</div>
              </div>

              <!-- 1st Place (Champion) -->
              <div class="podium-place first">
                <mat-icon class="trophy-icon gold">emoji_events</mat-icon>
                <div class="place-number">1st</div>
                <div class="team-name">{{ finalStandings[0]?.teamName }}</div>
                <div class="champion-label">CHAMPION</div>
              </div>

              <!-- 3rd Place -->
              <div class="podium-place third">
                <mat-icon class="medal-icon bronze">military_tech</mat-icon>
                <div class="place-number">3rd</div>
                <div class="team-name">{{ finalStandings[2]?.teamName }}</div>
                <div class="eliminated-info">Eliminated in Round {{ finalStandings[2]?.eliminatedInRound }}</div>
              </div>
            </div>

            <!-- Full Rankings Table -->
            <mat-card class="rankings-card" *ngIf="finalStandings.length > 0">
              <mat-card-header>
                <mat-icon mat-card-avatar>leaderboard</mat-icon>
                <mat-card-title>Complete Rankings</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <table class="rankings-table">
                  <thead>
                    <tr>
                      <th>Rank</th>
                      <th>Team</th>
                      <th>Status</th>
                      <th>Final Round</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let standing of finalStandings" [class.champion-row]="standing.placement === 1">
                      <td class="rank-cell">
                        <span class="rank-badge" [class.gold]="standing.placement === 1" [class.silver]="standing.placement === 2" [class.bronze]="standing.placement === 3">
                          {{ standing.placement }}
                        </span>
                      </td>
                      <td class="team-cell">{{ standing.teamName }}</td>
                      <td class="status-cell">
                        <span class="status-badge" [ngClass]="{
                          'champion': standing.status === 4,
                          'eliminated': standing.status === 3
                        }">
                          {{ standing.status === 4 ? 'Champion' : 'Eliminated' }}
                        </span>
                      </td>
                      <td class="round-cell">Round {{ standing.eliminatedInRound }}</td>
                    </tr>
                  </tbody>
                </table>
              </mat-card-content>
            </mat-card>

            <!-- Empty State -->
            <div class="empty-state" *ngIf="finalStandings.length === 0">
              <mat-icon class="empty-icon">emoji_events</mat-icon>
              <p>No results available yet</p>
            </div>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
<!-- Loading Indicator -->
<div class="loading-container" *ngIf="isReloading">
  <mat-spinner></mat-spinner>
  <p>Loading tournament data...</p>
</div>
<!-- Confirmation Dialog Template -->
<ng-template #confirmDialog>
  <h2 mat-dialog-title>Confirm Removal</h2>
  <mat-dialog-content>
    Are you sure you want to remove <strong>{{ teamToRemove?.name }}</strong> from this tournament?
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancel</button>
    <button mat-raised-button color="warn" [mat-dialog-close]="true">Remove</button>
  </mat-dialog-actions>
</ng-template>
<!-- Error Messages -->
<div *ngIf="errorMessage" class="error-container">
  <mat-icon>error</mat-icon>
  <p>{{ errorMessage }}</p>
  <button mat-icon-button (click)="errorMessage = ''">
    <mat-icon>close</mat-icon>
  </button>
</div>
