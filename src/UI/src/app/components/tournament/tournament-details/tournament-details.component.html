<div class="tournament-details-container">
  <div class="tournament-details-card" *ngIf="tournament$ | async as tournament">

    <!-- Tournament State Banner -->
    <!--<app-tournament-state-banner
      [tournamentState]="tournamentState"
      [isRegistrationOpen]="tournament?.isRegistrationOpen || false">
    </app-tournament-state-banner>-->

    <!-- Tabs Container -->
    <div class="tabs-container">
      <p-tabView [(activeIndex)]="activeTabIndex">
      <!-- Overview Tab -->
      <p-tabPanel header="Overview">
        <div class="tab-content">
          <div class="overview-grid">
            <!-- Tournament Info -->
            <app-tournament-info-card
              [tournament]="tournament"
              [groups]="groups"
              [brackets]="brackets">
            </app-tournament-info-card>

            <!-- Team Management -->
            <app-team-management-card
              *ngIf="tournament?.isRegistrationOpen"
              [tournament]="tournament"
              [isAddingTeams]="isAddingTeams"
              (addTeams)="addBulkTeams($event)">
            </app-team-management-card>

            <!-- Top 4 Results -->
            <app-top-results-card
              *ngIf="tournamentState?.currentStatus === TournamentStatus.Finished && finalStandings.length > 0"
              [finalStandings]="finalStandings">
            </app-top-results-card>
          </div>

          <!-- Registered Teams -->
          <app-registered-teams-list
            [teams]="tournament?.teams || []"
            [isRegistrationOpen]="tournament?.isRegistrationOpen || false"
            (removeTeam)="confirmRemoveTeam($event)">
          </app-registered-teams-list>
        </div>
      </p-tabPanel>

      <!-- Group Stage Tab (only if format has groups and tournament has started) -->
      <p-tabPanel header="Group Stage" *ngIf="!tournament?.isRegistrationOpen && (tournament?.format === Format.GroupsAndBracket || tournament?.format === Format.GroupsOnly)">
        <div class="tab-content">
          <app-standing-group
            [tournament]="tournament"
            (matchFinished)="onGroupMatchFinished($event)">
          </app-standing-group>
        </div>
      </p-tabPanel>

      <!-- Bracket Tab (only show when bracket is seeded and in progress or finished) -->
      <p-tabPanel header="Bracket" *ngIf="brackets.length > 0 && (tournamentState?.currentStatus === TournamentStatus.BracketInProgress || tournamentState?.currentStatus === TournamentStatus.Finished)">
        <div class="tab-content">
          <app-standing-bracket
            [tournament]="tournament"
            [standingId]="brackets[0].id"
            [tournamentState]="tournamentState"
            [teams]="tournament.teams"
            (matchFinished)="onBracketMatchFinished($event)">
          </app-standing-bracket>
        </div>
      </p-tabPanel>

      <!-- Results Tab (only if tournament is finished and we have results) -->
      <p-tabPanel header="Results" *ngIf="tournamentState?.currentStatus === TournamentStatus.Finished && finalStandings.length > 0">
        <div class="tab-content results-tab-content">
          <app-final-standings-display
            [finalStandings]="finalStandings">
          </app-final-standings-display>
        </div>
      </p-tabPanel>
    </p-tabView>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isReloading">
    <div class="loading-spinner">
      <p-progressSpinner></p-progressSpinner>
      <p>Loading tournament data...</p>
    </div>
  </div>

  <!-- Error State (centered card if no tournament) -->
  <div class="error-container" *ngIf="!tournament && errorMessage">
    <div class="error-card">
      <i class="pi pi-exclamation-triangle"></i>
      <h3>Error Loading Tournament</h3>
      <p>{{ errorMessage }}</p>
      <button class="retry-button" (click)="loadTournamentData()">
        <i class="pi pi-refresh"></i> Retry
      </button>
    </div>
  </div>
</div>
