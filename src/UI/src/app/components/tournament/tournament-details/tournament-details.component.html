<div class="tournament-details-container" *ngIf="tournament$ | async as tournament">
  <!-- Tournament Header -->
  <app-tournament-header
    [tournament]="tournament"
    [tournamentState]="tournamentState"
    [isReloading]="isReloading"
    (startGroups)="onStartGroups()"
    (startTournament)="startTournament()"
    (startBracket)="onStartBracket()">
  </app-tournament-header>

  <!-- Tournament State Banner -->
  <app-tournament-state-banner
    [tournamentState]="tournamentState"
    [isRegistrationOpen]="tournament?.isRegistrationOpen || false">
  </app-tournament-state-banner>

  <!-- Main Content Area -->
  <div class="tournament-content">
    <p-tabView [(activeIndex)]="activeTabIndex">
      <!-- Overview Tab -->
      <p-tabPanel header="Overview">
        <div class="tab-content">
          <div class="overview-grid">
            <!-- Tournament Info -->
            <app-tournament-info-card
              [tournament]="tournament"
              [groups]="groups"
              [brackets]="brackets">
            </app-tournament-info-card>

            <!-- Team Management -->
            <app-team-management-card
              *ngIf="tournament?.isRegistrationOpen"
              [tournament]="tournament"
              [isAddingTeams]="isAddingTeams"
              (addTeams)="addBulkTeams($event)">
            </app-team-management-card>

            <!-- Top 4 Results -->
            <app-top-results-card
              *ngIf="tournamentState?.currentStatus === TournamentStatus.Finished && finalStandings.length > 0"
              [finalStandings]="finalStandings">
            </app-top-results-card>
          </div>

          <!-- Registered Teams -->
          <app-registered-teams-list
            [teams]="tournament?.teams || []"
            [isRegistrationOpen]="tournament?.isRegistrationOpen || false"
            (removeTeam)="confirmRemoveTeam($event)">
          </app-registered-teams-list>
        </div>
      </p-tabPanel>

      <!-- Group Stage Tab (only if format is BracketAndGroups and tournament has started) -->
      <p-tabPanel header="Group Stage" *ngIf="!tournament?.isRegistrationOpen && tournament?.format === Format.GroupsAndBracket">
        <div class="tab-content">
          <app-standing-group
            [tournament]="tournament"
            (matchFinished)="onGroupMatchFinished($event)">
          </app-standing-group>
        </div>
      </p-tabPanel>

      <!-- Bracket Tab (only show when bracket is seeded and in progress or finished) -->
      <p-tabPanel header="Bracket" *ngIf="brackets.length > 0 && (tournamentState?.currentStatus === TournamentStatus.BracketInProgress || tournamentState?.currentStatus === TournamentStatus.Finished)">
        <div class="tab-content">
          <app-standing-bracket
            [tournament]="tournament"
            [standingId]="brackets[0]?.id"
            [tournamentState]="tournamentState"
            [teams]="tournament.teams"
            (matchFinished)="onBracketMatchFinished($event)">
          </app-standing-bracket>
        </div>
      </p-tabPanel>

      <!-- Results Tab (only if tournament is finished and we have results) -->
      <p-tabPanel header="Results" *ngIf="tournamentState?.currentStatus === TournamentStatus.Finished && finalStandings.length > 0">
        <div class="tab-content results-tab-content">
          <app-final-standings-display
            [finalStandings]="finalStandings">
          </app-final-standings-display>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
</div>

<!-- Loading Indicator -->
<div class="loading-container" *ngIf="isReloading">
  <p-progressSpinner></p-progressSpinner>
  <p>Loading tournament data...</p>
</div>

<!-- Error Messages -->
<div *ngIf="errorMessage" class="error-container">
  <i class="pi pi-exclamation-circle"></i>
  <p>{{ errorMessage }}</p>
  <button pButton icon (click)="errorMessage = ''">
    <i class="pi pi-times"></i>
  </button>
</div>
